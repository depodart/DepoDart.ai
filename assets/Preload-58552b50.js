import{n as ne,o as oe,p as se,q as ie,r as ce,E as ue,s as le,t as ae,v as de,w as fe,u as B,W as pe,x as ve}from"./events-776716bd.esm-5c540336.js";import{r as o,j as f}from"./index-f1053f9b.js";function N(e,r){let t;return(...s)=>{window.clearTimeout(t),t=window.setTimeout(()=>e(...s),r)}}function he({debounce:e,scroll:r,polyfill:t,offsetSize:s}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[l,c]=o.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),n=o.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l,orientationHandler:null}),p=e?typeof e=="number"?e:e.scroll:null,a=e?typeof e=="number"?e:e.resize:null,w=o.useRef(!1);o.useEffect(()=>(w.current=!0,()=>void(w.current=!1)));const[_,g,v]=o.useMemo(()=>{const u=()=>{if(!n.current.element)return;const{left:z,top:P,width:j,height:x,bottom:L,right:H,x:M,y:S}=n.current.element.getBoundingClientRect(),d={left:z,top:P,width:j,height:x,bottom:L,right:H,x:M,y:S};n.current.element instanceof HTMLElement&&s&&(d.height=n.current.element.offsetHeight,d.width=n.current.element.offsetWidth),Object.freeze(d),w.current&&!Ee(n.current.lastBounds,d)&&c(n.current.lastBounds=d)};return[u,a?N(u,a):u,p?N(u,p):u]},[c,s,p,a]);function b(){n.current.scrollContainers&&(n.current.scrollContainers.forEach(u=>u.removeEventListener("scroll",v,!0)),n.current.scrollContainers=null),n.current.resizeObserver&&(n.current.resizeObserver.disconnect(),n.current.resizeObserver=null),n.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",n.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",n.current.orientationHandler))}function y(){n.current.element&&(n.current.resizeObserver=new i(v),n.current.resizeObserver.observe(n.current.element),r&&n.current.scrollContainers&&n.current.scrollContainers.forEach(u=>u.addEventListener("scroll",v,{capture:!0,passive:!0})),n.current.orientationHandler=()=>{v()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",n.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",n.current.orientationHandler))}const O=u=>{!u||u===n.current.element||(b(),n.current.element=u,n.current.scrollContainers=J(u),y())};return we(v,!!r),me(g),o.useEffect(()=>{b(),y()},[r,v,g]),o.useEffect(()=>b,[]),[O,l,_]}function me(e){o.useEffect(()=>{const r=e;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[e])}function we(e,r){o.useEffect(()=>{if(r){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[e,r])}function J(e){const r=[];if(!e||e===document.body)return r;const{overflow:t,overflowX:s,overflowY:i}=window.getComputedStyle(e);return[t,s,i].some(l=>l==="auto"||l==="scroll")&&r.push(e),[...r,...J(e.parentElement)]}const be=["x","y","top","bottom","left","right","width","height"],Ee=(e,r)=>be.every(t=>e[t]===r[t]);var ge=Object.defineProperty,ye=Object.defineProperties,xe=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,A=(e,r,t)=>r in e?ge(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,Y=(e,r)=>{for(var t in r||(r={}))Ce.call(r,t)&&A(e,t,r[t]);if(X)for(var t of X(r))Re.call(r,t)&&A(e,t,r[t]);return e},_e=(e,r)=>ye(e,xe(r)),q,G;typeof window<"u"&&((q=window.document)!=null&&q.createElement||((G=window.navigator)==null?void 0:G.product)==="ReactNative")?o.useLayoutEffect:o.useEffect;function K(e,r,t){if(!e)return;if(t(e)===!0)return e;let s=r?e.return:e.child;for(;s;){const i=K(s,r,t);if(i)return i;s=r?null:s.sibling}}function Q(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const V=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=V;return}return V.apply(this,arguments)};const F=Q(o.createContext(null));class U extends o.Component{render(){return o.createElement(F.Provider,{value:this._reactInternals},this.props.children)}}function Oe(){const e=o.useContext(F);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const r=o.useId();return o.useMemo(()=>{for(const s of[e,e==null?void 0:e.alternate]){if(!s)continue;const i=K(s,!1,l=>{let c=l.memoizedState;for(;c;){if(c.memoizedState===r)return!0;c=c.next}});if(i)return i}},[e,r])}function ze(){const e=Oe(),[r]=o.useState(()=>new Map);r.clear();let t=e;for(;t;){if(t.type&&typeof t.type=="object"){const i=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;i&&i!==F&&!r.has(i)&&r.set(i,o.useContext(Q(i)))}t=t.return}return r}function Pe(){const e=ze();return o.useMemo(()=>Array.from(e.keys()).reduce((r,t)=>s=>o.createElement(r,null,o.createElement(t.Provider,_e(Y({},s),{value:e.get(t)}))),r=>o.createElement(U,Y({},r))),[e])}const je=o.forwardRef(function({children:r,fallback:t,resize:s,style:i,gl:l,events:c=de,eventSource:n,eventPrefix:p,shadows:a,linear:w,flat:_,legacy:g,orthographic:v,frameloop:b,dpr:y,performance:O,raycaster:u,camera:z,scene:P,onPointerMissed:j,onCreated:x,...L},H){o.useMemo(()=>ne(fe),[]);const M=Pe(),[S,d]=he({scroll:!0,debounce:{scroll:50,resize:0},...s}),C=o.useRef(null),T=o.useRef(null);o.useImperativeHandle(H,()=>C.current);const I=oe(j),[W,Z]=o.useState(!1),[k,$]=o.useState(!1);if(W)throw W;if(k)throw k;const R=o.useRef(null);se(()=>{const E=C.current;d.width>0&&d.height>0&&E&&(R.current||(R.current=ie(E)),R.current.configure({gl:l,events:c,shadows:a,linear:w,flat:_,legacy:g,orthographic:v,frameloop:b,dpr:y,performance:O,raycaster:u,camera:z,scene:P,size:d,onPointerMissed:(...h)=>I.current==null?void 0:I.current(...h),onCreated:h=>{h.events.connect==null||h.events.connect(n?ce(n)?n.current:n:T.current),p&&h.setEvents({compute:(D,m)=>{const re=D[p+"X"],te=D[p+"Y"];m.pointer.set(re/m.size.width*2-1,-(te/m.size.height)*2+1),m.raycaster.setFromCamera(m.pointer,m.camera)}}),x==null||x(h)}}),R.current.render(f.jsx(M,{children:f.jsx(ue,{set:$,children:f.jsx(o.Suspense,{fallback:f.jsx(le,{set:Z}),children:r})})})))}),o.useEffect(()=>{const E=C.current;if(E)return()=>ae(E)},[]);const ee=n?"none":"auto";return f.jsx("div",{ref:T,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ee,...i},...L,children:f.jsx("div",{ref:S,style:{width:"100%",height:"100%"},children:f.jsx("canvas",{ref:C,style:{display:"block"},children:t})})})}),Me=o.forwardRef(function(r,t){return f.jsx(U,{children:f.jsx(je,{...r,ref:t})})});function Se({all:e,scene:r,camera:t}){const s=B(({gl:c})=>c),i=B(({camera:c})=>c),l=B(({scene:c})=>c);return o.useLayoutEffect(()=>{const c=[];e&&(r||l).traverse(a=>{a.visible===!1&&(c.push(a),a.visible=!0)}),s.compile(r||l,t||i);const n=new pe(128);new ve(.01,1e5,n).update(s,r||l),n.dispose(),c.forEach(a=>a.visible=!1)},[]),null}export{Me as C,Se as P};
